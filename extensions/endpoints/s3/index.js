"use strict";var e=require("aws-sdk"),o=require("multer")(),c=function(c){c.post("/upload-photo",o.single("file"),(function(o,c){var n=o.file;console.log("req",n),e.config.update({accessKeyId:process.env.STORAGE_S3_KEY,secretAccessKey:process.env.STORAGE_S3_SECRET,region:process.env.STORAGE_S3_REGION});var s=new e.S3,t=(new Date).getTime(),r=n.originalname.split("."),i=r.slice(0,-1).join("."),a=r.slice(-1)[0],l="".concat(i,"-").concat(t,".").concat(a);s.upload({Bucket:process.env.STORAGE_S3_BUCKET,Body:n.buffer,Key:l,ContentType:n.mimetype}).promise().then((function(e){console.log("Upload succeeded - ",e);var o=e.Location;return c.send({data:{url:o}})})).catch((function(e){console.log("Upload failed:",e)}))}))};module.exports=c;
